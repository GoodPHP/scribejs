/* scribejs-editor v1.0.1 */
var S=class{constructor(e,t){this.savedSnapshots=[];this.isComposing=!1;this.doc=e,this.contentEl=t,t.addEventListener("compositionstart",()=>{this.isComposing=!0}),t.addEventListener("compositionend",()=>{this.isComposing=!1})}get composing(){return this.isComposing}isSelectionInContent(){if(this.isComposing)return!1;let e=this.doc.getSelection();if(!e||e.rangeCount===0)return!1;let t=e.getRangeAt(0);return this.contentEl.contains(t.commonAncestorContainer)}getSelection(){if(this.isComposing)return null;let e=this.doc.getSelection();if(!e||e.rangeCount===0)return null;let t=e.getRangeAt(0);if(!this.contentEl.contains(t.commonAncestorContainer))return null;t=this.normalizeRange(t);let o=e.toString(),i=t.collapsed,a=null;if(!i){let d=t.getClientRects();if(d.length>0){let s=d[0],g=d[d.length-1],h=Math.min(s.left,g.left),C=s.top,p=Math.max(s.right,g.right),y=g.bottom;a=new DOMRect(h,C,p-h,y-C)}}return{range:t.cloneRange(),collapsed:i,text:o,rect:a,formats:this.getFormats(t)}}normalizeRange(e){let t=e.cloneRange();if(t.collapsed)return t;if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startOffset===t.startContainer.length&&t.startContainer.nextSibling&&t.setStartBefore(t.startContainer.nextSibling),t.endContainer===this.contentEl&&t.endOffset>0){let o=this.contentEl.childNodes[t.endOffset-1];o&&t.setEndAfter(o)}if(t.endOffset===0&&t.endContainer!==this.contentEl){let o=t.endContainer;t.setEndBefore(o)}if(t.endContainer.nodeType===Node.ELEMENT_NODE&&t.endOffset>0){let o=t.endContainer.childNodes[t.endOffset-1];o&&o.nodeName==="BR"&&t.setEndBefore(o)}return t}getFormats(e){let t=this.doc.getSelection();if(!t||t.rangeCount===0)return this.getDefaultFormats();let o=e||t.getRangeAt(0),i=o.commonAncestorContainer;if(!o.collapsed){let p=o.startContainer,y=o.startOffset;if(p.nodeType===Node.TEXT_NODE&&y===p.length){let E=p.nextSibling;E&&(p=E,y=0)}for(;p.nodeType===Node.ELEMENT_NODE&&p.childNodes.length>y;){let E=p.childNodes[y];if(!E)break;if(E.nodeType===Node.TEXT_NODE&&!E.textContent?.trim()&&E.nextSibling){p=E.nextSibling,y=0;continue}p=E,y=0}i=p}let a=i.nodeType===Node.TEXT_NODE?i.parentElement:i;if(!a||a!==this.contentEl&&!this.contentEl.contains(a))return this.getDefaultFormats();let s=(a.ownerDocument.defaultView||window).getComputedStyle(a),g=s.textDecorationLine||s.textDecoration||"",h=s.fontWeight,C=h==="bold"||h==="bolder"||parseInt(h)>=700;return{bold:this.hasTag(a,"b")||this.hasTag(a,"strong")||C,italic:this.hasTag(a,"i")||this.hasTag(a,"em")||s.fontStyle==="italic",underline:this.hasTag(a,"u")||g.includes("underline"),strike:this.hasTag(a,"s")||this.hasTag(a,"strike")||this.hasTag(a,"del")||g.includes("line-through"),code:this.hasTag(a,"code"),subscript:this.hasTag(a,"sub"),superscript:this.hasTag(a,"sup"),link:this.getLinkUrl(a),heading:this.getHeadingLevel(a),list:this.getListType(a),blockquote:this.hasTag(a,"blockquote"),align:this.getAlignment(a,s),fontSize:s.fontSize||null,fontFamily:s.fontFamily||null,color:s.color||null,backgroundColor:this.getExplicitBackground(a)}}getDefaultFormats(){return{bold:!1,italic:!1,underline:!1,strike:!1,code:!1,subscript:!1,superscript:!1,link:null,heading:null,list:null,blockquote:!1,align:"left",fontSize:null,fontFamily:null,color:null,backgroundColor:null}}getExplicitBackground(e){let t=e;for(;t&&t!==this.contentEl;){let o=t.style.backgroundColor;if(o&&o!=="transparent"&&o!==""||t.tagName.toLowerCase()==="span"&&o)return o;t=t.parentElement}return null}hasTag(e,t){let o=e;for(;o&&o!==this.contentEl;){if(o.tagName.toLowerCase()===t.toLowerCase())return!0;o=o.parentElement}return!1}getLinkUrl(e){let t=e;for(;t&&t!==this.contentEl;){if(t.tagName.toLowerCase()==="a")return t.href||null;t=t.parentElement}return null}getHeadingLevel(e){let t=e;for(;t&&t!==this.contentEl;){let o=t.tagName.match(/^H([1-6])$/i);if(o)return parseInt(o[1]);t=t.parentElement}return null}getListType(e){let t=e;for(;t&&t!==this.contentEl;){if(t.tagName.toLowerCase()==="ol")return"ordered";if(t.tagName.toLowerCase()==="ul")return"unordered";t=t.parentElement}return null}getAlignment(e,t){let o=e;for(;o&&o!==this.contentEl;){let i=o.style.textAlign;if(i&&i!=="inherit"&&i!==""){let g=this.mapAlign(i);if(g)return g}let a=o.getAttribute("align");if(a){let g=this.mapAlign(a);if(g)return g}let d=o.tagName.toLowerCase();if(["p","div","h1","h2","h3","h4","h5","h6","li","blockquote","article","section"].includes(d)){let g=window.getComputedStyle(o).textAlign,h=this.mapAlign(g);if(h)return h}o=o.parentElement}return this.mapAlign(t.textAlign)||"left"}mapAlign(e){if(!e)return null;let t=e.toLowerCase();return t==="center"||t.includes("center")?"center":t==="right"||t==="end"?"right":t==="justify"||t==="full"?"justify":t==="left"||t==="start"?"left":null}saveSelection(e="manual"){if(this.isComposing)return;let t=this.doc.getSelection();if(t&&t.rangeCount>0){let o=t.getRangeAt(0);this.savedSnapshots.push({range:this.normalizeRange(o),timestamp:Date.now(),reason:e})}}restoreSelection(){let e=this.savedSnapshots.pop();if(!e)return!1;let t=this.doc.getSelection();return t?(t.removeAllRanges(),t.addRange(e.range),!0):!1}clearSavedSelections(){this.savedSnapshots=[]}get snapshotCount(){return this.savedSnapshots.length}setSelection(e){let t=this.doc.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}selectAll(){let e=this.doc.createRange();e.selectNodeContents(this.contentEl),this.setSelection(e)}collapse(e=!1){let t=this.doc.getSelection();!t||t.rangeCount===0||(e?t.collapseToStart():t.collapseToEnd())}getCursorPosition(){let e=this.doc.getSelection();if(!e||e.rangeCount===0)return null;let t=e.getRangeAt(0),o=t.getBoundingClientRect();if(o.width===0&&o.height===0){let i=this.doc.createElement("span");i.textContent="\u200B",t.insertNode(i);let a=i.getBoundingClientRect();return i.parentNode?.removeChild(i),{top:a.top,left:a.left,height:a.height||20}}return{top:o.top,left:o.left,height:o.height}}getSelectionRect(){let e=this.doc.getSelection();return!e||e.rangeCount===0?null:e.getRangeAt(0).getBoundingClientRect()}getSelectionOffsets(){let e=this.getSelection();if(!e||!e.range)return null;let t=e.range,o=t.cloneRange();o.selectNodeContents(this.contentEl),o.setEnd(t.startContainer,t.startOffset);let i=o.toString().length;return{start:i,end:i+t.toString().length}}};var J=["p","br","hr","h1","h2","h3","h4","h5","h6","strong","b","em","i","u","s","strike","del","sup","sub","code","pre","blockquote","q","ul","ol","li","a","img","table","thead","tbody","tfoot","tr","th","td","div","span","figure","figcaption"],X={"*":["class","id","style","data-*"],a:["href","target","rel","title"],img:["src","alt","width","height","title"],td:["colspan","rowspan"],th:["colspan","rowspan","scope"]},$=["http","https","mailto","tel"],Z=["script","style","iframe","object","embed","form","input","button"],v=class{constructor(e={}){this.config={allowedTags:e.allowedTags||J,allowedAttributes:e.allowedAttributes||X,allowedSchemes:e.allowedSchemes||$,stripEmpty:e.stripEmpty??!0}}sanitize(e){let o=new DOMParser().parseFromString(e,"text/html").body;return this.processNode(o),o.innerHTML}processNode(e){let t=Array.from(e.childNodes);for(let s=t.length-1;s>=0;s--)this.processNode(t[s]);if(e.nodeType!==Node.ELEMENT_NODE)return;let o=e,i=o.tagName.toLowerCase();if(Z.includes(i)){o.remove();return}if(!this.config.allowedTags.includes(i)){let s=o.parentNode;if(s){for(;o.firstChild;)s.insertBefore(o.firstChild,o);o.remove()}return}let a=this.getAllowedAttributes(i),d=Array.from(o.attributes);for(let s of d){if(!this.isAttributeAllowed(s.name,a)){o.removeAttribute(s.name);continue}["href","src"].includes(s.name)&&(this.isUrlSafe(s.value)||o.removeAttribute(s.name)),s.name.startsWith("on")&&o.removeAttribute(s.name),s.name==="style"&&o.setAttribute("style",this.sanitizeStyle(s.value))}this.config.stripEmpty&&this.isEmpty(o)&&!["br","hr","img"].includes(i)&&o.remove()}getAllowedAttributes(e){let t=this.config.allowedAttributes["*"]||[],o=this.config.allowedAttributes[e]||[];return[...t,...o]}isAttributeAllowed(e,t){if(t.includes(e))return!0;for(let o of t)if(o.endsWith("*")){let i=o.slice(0,-1);if(e.startsWith(i))return!0}return!1}isUrlSafe(e){try{if(e.startsWith("/")||e.startsWith("./")||e.startsWith("../")||e.startsWith("data:image/"))return!0;let o=new URL(e,"http://example.com").protocol.slice(0,-1);return this.config.allowedSchemes.includes(o)}catch{return!1}}sanitizeStyle(e){let t=["expression","javascript:","behavior","binding","-moz-binding","url("],o=e;for(let i of t){let a=new RegExp(i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");o=o.replace(a,"")}return o}isEmpty(e){return e.textContent?.trim()===""&&e.children.length===0}sanitizePaste(e){let t=e.replace(/<o:p[^>]*>[\s\S]*?<\/o:p>/gi,"").replace(/<\/?o:[^>]*>/gi,"").replace(/<!--\[if[^\]]*\]>[\s\S]*?<!\[endif\]-->/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<\/?xml[^>]*>/gi,"").replace(/<\/?st1:[^>]*>/gi,"").replace(/class="Mso[^"]*"/gi,"").replace(/style="[^"]*mso-[^"]*"/gi,"");return t=t.replace(/class="[^"]*docs-[^"]*"/gi,"").replace(/id="docs-[^"]*"/gi,""),t=t.replace(/\s+/g," ").replace(/>\s+</g,"><"),this.sanitize(t)}};var k=class{constructor(e=100){this.stack=[];this.position=-1;this.debounceTimer=null;this.debounceDelay=300;this.lastContent="";this.maxSize=e}push(e,t){e!==this.lastContent&&(this.lastContent=e,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.addEntry(e,t)},this.debounceDelay))}pushImmediate(e,t){this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),e!==this.lastContent&&(this.lastContent=e,this.addEntry(e,t))}addEntry(e,t){this.stack=this.stack.slice(0,this.position+1),this.stack.push({html:e,selection:t,timestamp:Date.now()}),this.stack.length>this.maxSize?this.stack.shift():this.position++}undo(){return this.canUndo()?(this.position--,this.stack[this.position]):null}redo(){return this.canRedo()?(this.position++,this.stack[this.position]):null}canUndo(){return this.position>0}canRedo(){return this.position<this.stack.length-1}getCurrent(){return this.position<0||this.position>=this.stack.length?null:this.stack[this.position]}clear(){this.stack=[],this.position=-1,this.lastContent="",this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}getStackSize(){return this.stack.length}getPosition(){return this.position}};var x=class n{static{this.INLINE_TAGS=new Set(["strong","b","em","i","u","s","strike","del","sub","sup","code","span","a","mark"])}static{this.PRESERVE_EMPTY=new Set(["br","hr","img","input"])}constructor(e){this.contentEl=e}normalize(){this.mergeAdjacentInlines(this.contentEl),this.removeEmptyNodes(this.contentEl),this.flattenNestedInlines(this.contentEl),this.cleanWhitespace(this.contentEl),this.removeBrowserJunk(this.contentEl),this.contentEl.normalize()}mergeAdjacentInlines(e){let t=Array.from(e.childNodes);for(let i=0;i<t.length-1;i++){let a=t[i],d=t[i+1];if(a.nodeType===Node.ELEMENT_NODE&&d.nodeType===Node.ELEMENT_NODE){let s=a,g=d;if(this.canMerge(s,g)){for(;g.firstChild;)s.appendChild(g.firstChild);g.remove(),i--;continue}}a.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(a)}let o=e.lastChild;o&&o.nodeType===Node.ELEMENT_NODE&&this.mergeAdjacentInlines(o)}canMerge(e,t){if(e.tagName!==t.tagName||!n.INLINE_TAGS.has(e.tagName.toLowerCase())||e.attributes.length!==t.attributes.length)return!1;for(let o=0;o<e.attributes.length;o++){let i=e.attributes[o];if(t.getAttribute(i.name)!==i.value)return!1}return!0}removeEmptyNodes(e){let t=Array.from(e.childNodes);for(let o of t)if(o.nodeType===Node.ELEMENT_NODE){let i=o,a=i.tagName.toLowerCase();this.removeEmptyNodes(i),n.INLINE_TAGS.has(a)&&!n.PRESERVE_EMPTY.has(a)&&!i.hasChildNodes()&&!i.textContent?.trim()&&i.remove()}}flattenNestedInlines(e){let t=Array.from(e.childNodes);for(let o of t){if(o.nodeType!==Node.ELEMENT_NODE)continue;let i=o,a=i.tagName.toLowerCase();if(this.flattenNestedInlines(i),!!n.INLINE_TAGS.has(a)&&i.childNodes.length===1&&i.firstChild?.nodeType===Node.ELEMENT_NODE){let d=i.firstChild;if(d.tagName===i.tagName&&this.canMerge(i,d)){for(;d.firstChild;)i.insertBefore(d.firstChild,d);d.remove()}}}}cleanWhitespace(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),o=[],i;for(;i=t.nextNode();)o.push(i);for(let a of o){let d=a.textContent||"";this.isInsidePreformatted(a)||(d=d.replace(/\u00A0{2,}/g,s=>" ".repeat(s.length)),d=d.replace(/ {3,}/g,"  "),d!==a.textContent&&(a.textContent=d))}}removeBrowserJunk(e){let t=Array.from(e.childNodes);for(let o of t){if(o.nodeType===Node.TEXT_NODE){if(o.textContent==="\u200B"||o.textContent==="\uFEFF"){o.remove();continue}o.textContent&&/[\u200B\uFEFF]/.test(o.textContent)&&(o.textContent=o.textContent.replace(/[\u200B\uFEFF]/g,""))}if(o.nodeType===Node.ELEMENT_NODE){let i=o;if(i.tagName.toLowerCase()==="span"&&!i.hasAttribute("style")&&!i.hasAttribute("class")&&!i.hasAttribute("data-type")&&i.attributes.length===0){for(;i.firstChild;)i.parentNode?.insertBefore(i.firstChild,i);i.remove();continue}this.removeBrowserJunk(i)}}}isInsidePreformatted(e){let t=e.parentNode;for(;t&&t!==this.contentEl;){if(t.nodeType===Node.ELEMENT_NODE){let o=t.tagName.toLowerCase();if(o==="pre"||o==="code")return!0}t=t.parentNode}return!1}};var w={bold:n=>{n.getDocument().execCommand("bold",!1)},italic:n=>{n.getDocument().execCommand("italic",!1)},underline:n=>{n.getDocument().execCommand("underline",!1)},strike:n=>{n.getDocument().execCommand("strikeThrough",!1)},subscript:n=>{n.getDocument().execCommand("subscript",!1)},superscript:n=>{n.getDocument().execCommand("superscript",!1)},code:n=>{let e=n.getSelection();if(!e||e.collapsed)return;let t=n.getDocument(),o=e.range;if(o)if(e.formats.code){let i=U(o.commonAncestorContainer,"code");if(i){let a=i.parentNode;for(;i.firstChild;)a?.insertBefore(i.firstChild,i);i.remove()}}else{let i=t.createElement("code");i.appendChild(o.extractContents()),o.insertNode(i)}},clearFormat:n=>{n.getDocument().execCommand("removeFormat",!1)},heading:(n,e)=>{let t=e?`h${e}`:"p";n.getDocument().execCommand("formatBlock",!1,t)},paragraph:n=>{n.getDocument().execCommand("formatBlock",!1,"p")},blockquote:n=>{n.getSelection()?.formats.blockquote?n.getDocument().execCommand("formatBlock",!1,"p"):n.getDocument().execCommand("formatBlock",!1,"blockquote")},codeBlock:n=>{n.getDocument().execCommand("formatBlock",!1,"pre")},orderedList:n=>{n.getDocument().execCommand("insertOrderedList",!1)},unorderedList:n=>{n.getDocument().execCommand("insertUnorderedList",!1)},alignLeft:n=>{n.getDocument().execCommand("justifyLeft",!1)},alignCenter:n=>{n.getDocument().execCommand("justifyCenter",!1)},alignRight:n=>{n.getDocument().execCommand("justifyRight",!1)},alignJustify:n=>{n.getDocument().execCommand("justifyFull",!1)},indent:n=>{n.getDocument().execCommand("indent",!1)},outdent:n=>{n.getDocument().execCommand("outdent",!1)},link:(n,e)=>{if(typeof e!="string")return;let t=n.getSelection();if(t)if(t.formats.link){let o=t.range;if(!o)return;let i=U(o.commonAncestorContainer,"a");i&&(i.href=e)}else t.collapsed||n.getDocument().execCommand("createLink",!1,e)},unlink:n=>{n.getDocument().execCommand("unlink",!1)},insertHR:n=>{n.getDocument().execCommand("insertHorizontalRule",!1)},insertHTML:(n,e)=>{typeof e=="string"&&n.getDocument().execCommand("insertHTML",!1,e)},insertText:(n,e)=>{typeof e=="string"&&n.getDocument().execCommand("insertText",!1,e)},selectAll:n=>{n.getDocument().execCommand("selectAll",!1)},undo:n=>{n.emit("undo")},redo:n=>{n.emit("redo")},setFontSize:(n,e)=>{if(typeof e!="string"&&typeof e!="number")return;let t=n.getSelection();if(!t||t.collapsed)return;let o=n.getDocument(),i=t.range;if(!i)return;let a=o.createElement("span");a.style.fontSize=typeof e=="number"?`${e}px`:e,a.appendChild(i.extractContents()),i.insertNode(a)},setFontFamily:(n,e)=>{typeof e=="string"&&n.getDocument().execCommand("fontName",!1,e)},setColor:(n,e)=>{typeof e=="string"&&n.getDocument().execCommand("foreColor",!1,e)},setBackgroundColor:(n,e)=>{typeof e=="string"&&n.getDocument().execCommand("hiliteColor",!1,e)}};function U(n,e){let t=n;for(;t;){if(t.nodeType===Node.ELEMENT_NODE&&t.tagName.toLowerCase()===e.toLowerCase())return t;t=t.parentNode}return null}var H=[{key:"b",ctrl:!0,command:"bold"},{key:"i",ctrl:!0,command:"italic"},{key:"u",ctrl:!0,command:"underline"},{key:"z",ctrl:!0,command:"undo"},{key:"z",ctrl:!0,shift:!0,command:"redo"},{key:"y",ctrl:!0,command:"redo"},{key:"\\",ctrl:!0,command:"clearFormat"},{key:"k",ctrl:!0,command:"link"}];var L=class{constructor(){this.commands=new Map}register(e){this.commands.set(e.name,e)}registerAll(e){e.forEach(t=>this.register(t))}get(e){return this.commands.get(e)}has(e){return this.commands.has(e)}getHandler(e){return this.commands.get(e)?.handler}getCommandState(e,t,o,i){let a=this.commands.get(e);if(!a)return null;let d=a.isActive?a.isActive(t):!1,s=!i,g=!i&&(!a.requiresSelection||o)&&(a.isEnabled?a.isEnabled({format:t,hasSelection:o,readOnly:i}):!0),h=a.getAttributes?a.getAttributes(t):void 0;return{name:a.name,label:a.label,category:a.category,type:a.type,active:d,supported:s,enabled:g,attributes:h,shortcut:a.shortcut,exclusiveGroup:a.exclusiveGroup,floatingToolbar:a.floatingToolbar,fixedToolbar:a.fixedToolbar,icon:a.icon,toolbarGroup:a.toolbarGroup,defaultArgs:a.defaultArgs}}getAllCommandStates(e,t,o){let i=[];return this.commands.forEach((a,d)=>{let s=this.getCommandState(d,e,t,o);s&&i.push(s)}),i}getToolbarCommands(e,t,o,i){let a=[];return this.commands.forEach((d,s)=>{if(!(e==="floating"?d.floatingToolbar:d.fixedToolbar))return;let h=this.getCommandState(s,t,o,i);h&&a.push(h)}),a}getNames(){return Array.from(this.commands.keys())}getByCategory(e){let t=[];return this.commands.forEach(o=>{o.category===e&&t.push(o)}),t}getExclusiveGroup(e){let t=[];return this.commands.forEach(o=>{o.exclusiveGroup===e&&t.push(o)}),t}};function R(n){return[{name:"undo",label:"Undo",category:"history",type:"action",handler:n.undo,icon:"undo",toolbarGroup:"history",shortcut:"Ctrl+Z",fixedToolbar:!0},{name:"redo",label:"Redo",category:"history",type:"action",handler:n.redo,icon:"redo",toolbarGroup:"history",shortcut:"Ctrl+Shift+Z",fixedToolbar:!0},{name:"bold",label:"Bold",category:"inline",type:"toggle",handler:n.bold,icon:"bold",toolbarGroup:"format",isActive:e=>e.bold,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+B",floatingToolbar:!0,fixedToolbar:!0},{name:"italic",label:"Italic",category:"inline",type:"toggle",handler:n.italic,icon:"italic",toolbarGroup:"format",isActive:e=>e.italic,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+I",floatingToolbar:!0,fixedToolbar:!0},{name:"underline",label:"Underline",category:"inline",type:"toggle",handler:n.underline,icon:"underline",toolbarGroup:"format",isActive:e=>e.underline,isEnabled:({format:e})=>!e.code,shortcut:"Ctrl+U",floatingToolbar:!0,fixedToolbar:!0},{name:"strike",label:"Strikethrough",category:"inline",type:"toggle",handler:n.strike,icon:"strikethrough",toolbarGroup:"format",isActive:e=>e.strike,isEnabled:({format:e})=>!e.code,floatingToolbar:!0,fixedToolbar:!0},{name:"code",label:"Inline Code",category:"inline",type:"toggle",handler:n.code,icon:"code",toolbarGroup:"format",isActive:e=>e.code,isEnabled:({format:e})=>!e.bold&&!e.italic,requiresSelection:!0,floatingToolbar:!0,fixedToolbar:!0},{name:"subscript",label:"Subscript",category:"inline",type:"toggle",handler:n.subscript,isActive:e=>e.subscript},{name:"superscript",label:"Superscript",category:"inline",type:"toggle",handler:n.superscript,isActive:e=>e.superscript},{name:"clearFormat",label:"Clear Formatting",category:"inline",type:"action",handler:n.clearFormat,icon:"removeFormatting",toolbarGroup:"misc",shortcut:"Ctrl+\\",fixedToolbar:!0},{name:"link",label:"Link",category:"insert",type:"apply",handler:n.link,icon:"link",toolbarGroup:"insert",isActive:e=>!!e.link,getAttributes:e=>e.link?{url:e.link}:void 0,shortcut:"Ctrl+K",floatingToolbar:!0,fixedToolbar:!0},{name:"unlink",label:"Unlink",category:"insert",type:"action",handler:n.unlink,isActive:e=>!!e.link},{name:"heading1",label:"Heading 1",category:"block",type:"apply",handler:n.heading,icon:"heading1",toolbarGroup:"block",isActive:e=>e.heading===1,exclusiveGroup:"blockType",defaultArgs:[1],floatingToolbar:!0,fixedToolbar:!0},{name:"heading2",label:"Heading 2",category:"block",type:"apply",handler:n.heading,icon:"heading2",toolbarGroup:"block",isActive:e=>e.heading===2,exclusiveGroup:"blockType",defaultArgs:[2],floatingToolbar:!0,fixedToolbar:!0},{name:"heading3",label:"Heading 3",category:"block",type:"apply",handler:n.heading,icon:"heading3",toolbarGroup:"block",isActive:e=>e.heading===3,exclusiveGroup:"blockType",defaultArgs:[3],fixedToolbar:!0},{name:"heading",label:"Heading",category:"block",type:"apply",handler:n.heading,isActive:e=>e.heading!==null,exclusiveGroup:"blockType"},{name:"paragraph",label:"Paragraph",category:"block",type:"apply",handler:n.paragraph,exclusiveGroup:"blockType"},{name:"blockquote",label:"Blockquote",category:"block",type:"toggle",handler:n.blockquote,icon:"quote",toolbarGroup:"block",isActive:e=>e.blockquote,floatingToolbar:!0,fixedToolbar:!0},{name:"codeBlock",label:"Code Block",category:"block",type:"apply",handler:n.codeBlock,exclusiveGroup:"blockType"},{name:"unorderedList",label:"Bullet List",category:"list",type:"toggle",handler:n.unorderedList,icon:"list",toolbarGroup:"list",isActive:e=>e.list==="unordered",exclusiveGroup:"listType",floatingToolbar:!0,fixedToolbar:!0},{name:"orderedList",label:"Numbered List",category:"list",type:"toggle",handler:n.orderedList,icon:"listOrdered",toolbarGroup:"list",isActive:e=>e.list==="ordered",exclusiveGroup:"listType",floatingToolbar:!0,fixedToolbar:!0},{name:"alignLeft",label:"Align Left",category:"alignment",type:"apply",handler:n.alignLeft,icon:"alignLeft",toolbarGroup:"align",isActive:e=>e.align==="left",exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignCenter",label:"Align Center",category:"alignment",type:"apply",handler:n.alignCenter,icon:"alignCenter",toolbarGroup:"align",isActive:e=>e.align==="center",exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignRight",label:"Align Right",category:"alignment",type:"apply",handler:n.alignRight,icon:"alignRight",toolbarGroup:"align",isActive:e=>e.align==="right",exclusiveGroup:"alignment",fixedToolbar:!0},{name:"alignJustify",label:"Justify",category:"alignment",type:"apply",handler:n.alignJustify,icon:"alignJustify",toolbarGroup:"align",isActive:e=>e.align==="justify",exclusiveGroup:"alignment"},{name:"indent",label:"Indent",category:"alignment",type:"action",handler:n.indent},{name:"outdent",label:"Outdent",category:"alignment",type:"action",handler:n.outdent},{name:"insertHR",label:"Horizontal Rule",category:"insert",type:"action",handler:n.insertHR},{name:"insertHTML",label:"Insert HTML",category:"insert",type:"action",handler:n.insertHTML},{name:"insertText",label:"Insert Text",category:"insert",type:"action",handler:n.insertText},{name:"setFontSize",label:"Font Size",category:"styling",type:"apply",handler:n.setFontSize,getAttributes:e=>e.fontSize?{size:e.fontSize}:void 0},{name:"setFontFamily",label:"Font Family",category:"styling",type:"apply",handler:n.setFontFamily,getAttributes:e=>e.fontFamily?{family:e.fontFamily}:void 0},{name:"setColor",label:"Text Color",category:"styling",type:"apply",handler:n.setColor,getAttributes:e=>e.color?{color:e.color}:void 0},{name:"setBackgroundColor",label:"Background Color",category:"styling",type:"apply",handler:n.setBackgroundColor,getAttributes:e=>e.backgroundColor?{color:e.backgroundColor}:void 0}]}function I(n){let e=typeof n.target=="string"?document.querySelector(n.target):n.target;if(!e)throw new Error("Scribe: Target element not found");let t=n.iframe?.contentDocument||e.ownerDocument;if(!t)throw new Error("Scribe: Could not access document");let o=new S(t,e),i=new v(n.sanitize),a=new k,d=new x(e),s=new L,g=!1,h=n.readOnly??!1,C=null,p=new Map,y=new Map,E=[...H],T=new Map,c=e;h||(c.contentEditable="true"),c.classList.add("scribe-editor","scribe-content"),n.placeholder&&c.setAttribute("data-placeholder",n.placeholder),Object.entries(w).forEach(([r,l])=>{y.set(r,l)}),s.registerAll(R(w));let K=(r,l)=>{if(!r)return Object.keys(l);let f=[];for(let b of Object.keys(l))r[b]!==l[b]&&f.push(b);return f},A=(r,l)=>{let f=K(C,r);if(f.length>0){let b={previous:C,current:r,changed:f,source:l};m.emit("formatChange",b)}C={...r}},u=(r,...l)=>{if(h)return;let f=s.get(r),b=f?.handler||y.get(r);if(b){let M=l.length>0?l:f?.defaultArgs||[];b(m,...M),d.normalize(),a.push(c.innerHTML,null),m.emit("change",c.innerHTML),n.onChange?.(c.innerHTML);let W=o.getFormats();A(W,"command"),requestAnimationFrame(()=>{let D=o.getSelection();m.emit("selectionChange",D),D&&A(D.formats,"command")})}},m={getDocument:()=>t,getContentElement:()=>c,getSelection:()=>o.getSelection(),getFormatState:()=>{let r=o.getSelection();return r?r.formats:o.getFormats()},getCommandState:r=>{let l=m.getFormatState(),f=o.getSelection(),b=f?!f.collapsed:!1;return s.getCommandState(r,l,b,h)},getAllCommandStates:()=>{let r=m.getFormatState(),l=o.getSelection(),f=l?!l.collapsed:!1;return s.getAllCommandStates(r,f,h)},exec:(r,...l)=>u(r,...l),canExec:r=>!!m.getCommandState(r)?.enabled,bold:()=>u("bold"),italic:()=>u("italic"),underline:()=>u("underline"),strike:()=>u("strike"),code:()=>u("code"),subscript:()=>u("subscript"),superscript:()=>u("superscript"),clearFormat:()=>u("clearFormat"),heading:r=>u("heading",r),paragraph:()=>u("paragraph"),blockquote:()=>u("blockquote"),codeBlock:()=>u("codeBlock"),orderedList:()=>u("orderedList"),unorderedList:()=>u("unorderedList"),alignLeft:()=>u("alignLeft"),alignCenter:()=>u("alignCenter"),alignRight:()=>u("alignRight"),alignJustify:()=>u("alignJustify"),indent:()=>u("indent"),outdent:()=>u("outdent"),link:r=>u("link",r),unlink:()=>u("unlink"),insertHR:()=>u("insertHR"),insertHTML:r=>u("insertHTML",r),insertText:r=>u("insertText",r),setFontSize:r=>u("setFontSize",r),setFontFamily:r=>u("setFontFamily",r),setColor:r=>u("setColor",r),setBackgroundColor:r=>u("setBackgroundColor",r),undo:()=>m.emit("undo"),redo:()=>m.emit("redo"),getHTML:()=>c.innerHTML,setHTML:r=>{let l=i.sanitize(r);c.innerHTML=l,d.normalize(),a.pushImmediate(l,null),m.emit("change",l)},getText:()=>c.textContent||"",isEmpty:()=>(c.textContent?.trim()||"")===""&&c.children.length<=1,saveSelection:r=>o.saveSelection(r||"manual"),restoreSelection:()=>{let r=o.restoreSelection();if(r){let l=o.getSelection();m.emit("selectionChange",l),l&&A(l.formats,"selection")}return r},focus:()=>{c.focus(),m.restoreSelection(),m.emit("focus")},blur:()=>c.blur(),normalize:()=>d.normalize(),getPlugin:r=>p.get(r),isReadOnly:()=>h,setReadOnly:r=>{h=r,c.contentEditable=r?"false":"true",m.emit("readOnlyChange",r)},on:(r,l)=>{T.has(r)||T.set(r,new Set),T.get(r).add(l)},off:(r,l)=>{T.get(r)?.delete(l)},emit:(r,...l)=>{T.get(r)?.forEach(f=>f(...l))},destroy:()=>{g||(g=!0,p.forEach(r=>r.destroy?.()),p.clear(),c.removeEventListener("input",B),c.removeEventListener("keydown",P),c.removeEventListener("keyup",_),c.removeEventListener("mouseup",q),c.removeEventListener("paste",O),c.removeEventListener("focus",z),c.removeEventListener("blur",G),t.removeEventListener("selectionchange",N),c.contentEditable="false",c.classList.remove("scribe-editor","scribe-content"),c.removeAttribute("data-placeholder"),T.clear(),a.clear(),m.emit("destroy"))}},B=()=>{h||(a.push(c.innerHTML,null),m.emit("change",c.innerHTML),n.onChange?.(c.innerHTML))},P=r=>{if(!h)for(let l of E){let f=l.ctrl?r.ctrlKey||r.metaKey:!(r.ctrlKey||r.metaKey),b=l.shift?r.shiftKey:!r.shiftKey,M=l.alt?r.altKey:!r.altKey;if(r.key.toLowerCase()===l.key.toLowerCase()&&f&&b&&M){r.preventDefault(),u(l.command,...l.args||[]);return}}},O=r=>{if(h)return;r.preventDefault();let l=r.clipboardData?.getData("text/html"),f=r.clipboardData?.getData("text/plain");if(l){let b=i.sanitizePaste(l);u("insertHTML",b)}else f&&u("insertText",f)},z=()=>{m.emit("focus"),n.onFocus?.()},G=()=>{m.emit("blur"),n.onBlur?.()},F=null,N=()=>{F&&cancelAnimationFrame(F),F=requestAnimationFrame(()=>{if(g)return;if(!o.isSelectionInContent()){m.emit("selectionChange",null);return}let l=o.getSelection();m.emit("selectionChange",l),n.onSelectionChange?.(l);let f=l?l.formats:o.getFormats();A(f,"selection")})},q=()=>{setTimeout(N,10)},_=r=>{(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(r.key)||r.key.length===1)&&N()};return m.on("undo",()=>{let r=a.undo();r&&(c.innerHTML=r.html,m.emit("change",r.html))}),m.on("redo",()=>{let r=a.redo();r&&(c.innerHTML=r.html,m.emit("change",r.html))}),c.addEventListener("input",B),c.addEventListener("keydown",P),c.addEventListener("keyup",_),c.addEventListener("mouseup",q),c.addEventListener("paste",O),c.addEventListener("focus",z),c.addEventListener("blur",G),t.addEventListener("selectionchange",N),n.plugins?.forEach(r=>{p.set(r.name,r),r.commands&&Object.entries(r.commands).forEach(([l,f])=>{y.set(l,f)}),r.shortcuts&&E.push(...r.shortcuts),r.init?.(m)}),a.pushImmediate(c.innerHTML,null),n.autofocus&&setTimeout(()=>m.focus(),0),m.emit("ready"),m}function j(n,e={}){let t=document.querySelector(n);if(!t)throw new Error(`Scribe: Element "${n}" not found`);return I({target:t,mode:"inline",...e})}var V={init:j,createEditor:I};var Y={name:"bold",toolbarItems:[{name:"bold",icon:"bold",title:"Bold (Ctrl+B)",command:"bold",isActive:n=>n.bold,group:"format"}]},Q={name:"italic",toolbarItems:[{name:"italic",icon:"italic",title:"Italic (Ctrl+I)",command:"italic",isActive:n=>n.italic,group:"format"}]},ee={name:"underline",toolbarItems:[{name:"underline",icon:"underline",title:"Underline (Ctrl+U)",command:"underline",isActive:n=>n.underline,group:"format"}]},te={name:"strike",toolbarItems:[{name:"strike",icon:"strikethrough",title:"Strikethrough",command:"strike",isActive:n=>n.strike,group:"format"}]},ne={name:"code",toolbarItems:[{name:"code",icon:"code",title:"Inline Code",command:"code",isActive:n=>n.code,group:"format"}]},oe={name:"heading",toolbarItems:[{name:"h1",icon:"heading1",title:"Heading 1",command:"heading",args:[1],isActive:n=>n.heading===1,group:"block"},{name:"h2",icon:"heading2",title:"Heading 2",command:"heading",args:[2],isActive:n=>n.heading===2,group:"block"},{name:"h3",icon:"heading3",title:"Heading 3",command:"heading",args:[3],isActive:n=>n.heading===3,group:"block"}]},ie={name:"list",toolbarItems:[{name:"unorderedList",icon:"list",title:"Bullet List",command:"unorderedList",isActive:n=>n.list==="unordered",group:"list"},{name:"orderedList",icon:"listOrdered",title:"Numbered List",command:"orderedList",isActive:n=>n.list==="ordered",group:"list"}]},re={name:"blockquote",toolbarItems:[{name:"blockquote",icon:"quote",title:"Quote",command:"blockquote",isActive:n=>n.blockquote,group:"block"}]},ae={name:"link",toolbarItems:[{name:"link",icon:"link",title:"Link (Ctrl+K)",command:"showLinkModal",isActive:n=>!!n.link,group:"insert"}]},le={name:"alignment",toolbarItems:[{name:"alignLeft",icon:"alignLeft",title:"Align Left",command:"alignLeft",isActive:n=>n.align==="left",group:"align"},{name:"alignCenter",icon:"alignCenter",title:"Align Center",command:"alignCenter",isActive:n=>n.align==="center",group:"align"},{name:"alignRight",icon:"alignRight",title:"Align Right",command:"alignRight",isActive:n=>n.align==="right",group:"align"}]},se={name:"clearFormat",toolbarItems:[{name:"clearFormat",icon:"removeFormatting",title:"Clear Formatting (Ctrl+\\)",command:"clearFormat",group:"misc"}]},ce={name:"history",toolbarItems:[{name:"undo",icon:"undo",title:"Undo (Ctrl+Z)",command:"undo",group:"history"},{name:"redo",icon:"redo",title:"Redo (Ctrl+Shift+Z)",command:"redo",group:"history"}]},de=[Y,Q,ee,te,ne,oe,ie,re,ae,le,se,ce];export{L as CommandRegistry,x as DOMNormalizer,v as HTMLSanitizer,k as HistoryManager,V as Scribe,S as SelectionManager,w as coreCommands,R as createDefaultRegistrations,I as createEditor,de as defaultPlugins,H as defaultShortcuts,j as init};
